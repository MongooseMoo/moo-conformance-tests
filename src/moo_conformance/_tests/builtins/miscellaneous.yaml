name: miscellaneous
description: Tests for isa() builtin function
# Converted from toaststunt test/tests/test_miscellaneous.rb

requires:
  builtins: [isa, create, valid]

tests:
  # isa() with object numbers
  - name: isa_returns_false_for_parent_child
    permission: programmer
    setup:
      permission: programmer
      code: |
        a = create($nothing);
        b = create(a);
    code: "isa(a, b)"
    expect:
      value: 0

  - name: isa_returns_true_for_child_parent
    permission: programmer
    setup:
      permission: programmer
      code: |
        a = create($nothing);
        b = create(a);
    code: "isa(b, a)"
    expect:
      value: 1

  - name: isa_nothing_child_returns_false
    permission: programmer
    setup:
      permission: programmer
      code: |
        a = create($nothing);
        b = create(a);
    code: "isa(b, $nothing)"
    expect:
      value: 0

  - name: isa_nothing_parent_returns_false
    permission: programmer
    setup:
      permission: programmer
      code: |
        a = create($nothing);
    code: "isa($nothing, a)"
    expect:
      value: 0

  - name: isa_nothing_nothing_returns_false
    code: "isa($nothing, $nothing)"
    expect:
      value: 0

  - name: isa_invalid_parent_returns_false
    code: "isa(#100000, #1)"
    expect:
      value: 0

  - name: isa_invalid_child_returns_false
    code: "isa(#1, #100000)"
    expect:
      value: 0

  - name: isa_both_invalid_returns_false
    code: "isa(#1000000, #1000000)"
    expect:
      value: 0

  - name: isa_negative_parent_returns_false
    code: "isa(#-2, #2)"
    expect:
      value: 0

  - name: isa_negative_child_returns_false
    code: "isa(#1, #-1)"
    expect:
      value: 0

  # isa() with objects created by create() builtin
  # NOTE: These tests have invalid code - set_property_info expects {owner, perms} list
  # not a single object. Skipped pending proper test rewrite.
  - name: isa_with_create_no_opt
    permission: programmer
    skip: "Test code invalid - set_property_info expects list not object"
    statement: |
      o = create($nothing);
      add_property(o, "b", 0, {player, ""});
      add_property(o, "c", 0, {player, ""});
      set_property_info(o, "b", create($nothing));
      set_property_info(o, "c", create(property_info(o, "b")[1], 0));
      return isa(property_info(o, "c")[1], property_info(o, "b")[1]);
    expect:
      value: 1

  - name: isa_with_create_opt_1
    permission: programmer
    skip: "Test code invalid - set_property_info expects list not object"
    statement: |
      o = create($nothing);
      add_property(o, "b", 0, {player, ""});
      add_property(o, "c", 0, {player, ""});
      set_property_info(o, "b", create($nothing));
      set_property_info(o, "c", create(property_info(o, "b")[1], 1));
      return isa(property_info(o, "c")[1], property_info(o, "b")[1]);
    expect:
      value: 1

  - name: isa_with_create_reverse_no_opt
    permission: programmer
    skip: "Test code invalid - set_property_info expects list not object"
    statement: |
      o = create($nothing);
      add_property(o, "b", 0, {player, ""});
      add_property(o, "c", 0, {player, ""});
      set_property_info(o, "b", create($nothing));
      set_property_info(o, "c", create(property_info(o, "b")[1], 0));
      return isa(property_info(o, "b")[1], property_info(o, "c")[1]);
    expect:
      value: 0

  - name: isa_with_create_reverse_opt_1
    permission: programmer
    skip: "Test code invalid - set_property_info expects list not object"
    statement: |
      o = create($nothing);
      add_property(o, "b", 0, {player, ""});
      add_property(o, "c", 0, {player, ""});
      set_property_info(o, "b", create($nothing));
      set_property_info(o, "c", create(property_info(o, "b")[1], 1));
      return isa(property_info(o, "b")[1], property_info(o, "c")[1]);
    expect:
      value: 0
