name: index_and_range
description: Index and range extensions with ^ (first) and $ (last) operators

requires:
  features: [index_extensions]

tests:
  # Caret (^) as index - maps
  - name: caret_map_first
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][^]'
    expect:
      value: 1

  - name: caret_map_first_plus_one
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][^ + 1]'
    expect:
      value: 2

  - name: caret_empty_map_error
    code: '[][^]'
    expect:
      error: E_RANGE

  - name: caret_map_assign_first
    statement: |
      t = ["a" -> 1, "b" -> 2, "c" -> 3];
      t[^] = "foobar";
      return t;
    expect:
      value: {"a": "foobar", "b": 2, "c": 3}

  - name: caret_map_assign_computed_key
    statement: |
      t = ["a" -> 1, "b" -> 2, "c" -> 3];
      t[^ + "*"] = "foobar";
      return t;
    expect:
      value: {"a": 1, "a*": "foobar", "b": 2, "c": 3}

  # Caret (^) as index - lists
  - name: caret_list_first
    code: '{1, 2, 3, 4, 5, 6, 7}[^]'
    expect:
      value: 1

  - name: caret_list_first_plus_one
    code: '{1, 2, 3, 4, 5, 6, 7}[^ + 1]'
    expect:
      value: 2

  - name: caret_empty_list_error
    code: '{}[^]'
    expect:
      error: E_RANGE

  - name: caret_list_assign_first
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[^] = "foobar";
      return t;
    expect:
      value: ["foobar", 2, 3, 4, 5, 6, 7]

  - name: caret_list_assign_first_plus_one
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[^ + 1] = "foobar";
      return t;
    expect:
      value: [1, "foobar", 3, 4, 5, 6, 7]

  # Caret (^) as index - strings
  - name: caret_string_first
    code: '"foobar"[^]'
    expect:
      value: "f"

  - name: caret_string_first_plus_one
    code: '"foobar"[^ + 1]'
    expect:
      value: "o"

  - name: caret_empty_string_error
    code: '""[^]'
    expect:
      error: E_RANGE

  - name: caret_string_assign_first
    statement: |
      t = "foobar";
      t[^] = "x";
      return t;
    expect:
      value: "xoobar"

  - name: caret_string_assign_first_plus_one
    statement: |
      t = "foobar";
      t[^ + 1] = "x";
      return t;
    expect:
      value: "fxobar"

  # Dollar ($) as index - maps
  - name: dollar_map_last
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][$]'
    expect:
      value: 7

  - name: dollar_map_last_minus_one
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][$ - 1]'
    expect:
      value: 6

  - name: dollar_empty_map_error
    code: '[][$]'
    expect:
      error: E_RANGE

  - name: dollar_map_assign_last
    statement: |
      t = ["a" -> 1, "b" -> 2, "c" -> 3];
      t[$] = "foobar";
      return t;
    expect:
      value: {"a": 1, "b": 2, "c": "foobar"}

  - name: dollar_map_assign_computed_key
    statement: |
      t = ["a" -> 1, "b" -> 2, "c" -> 3];
      t[$ + "*"] = "foobar";
      return t;
    expect:
      value: {"a": 1, "b": 2, "c": 3, "c*": "foobar"}

  # Dollar ($) as index - lists
  - name: dollar_list_last
    code: '{1, 2, 3, 4, 5, 6, 7}[$]'
    expect:
      value: 7

  - name: dollar_list_last_minus_one
    code: '{1, 2, 3, 4, 5, 6, 7}[$ - 1]'
    expect:
      value: 6

  - name: dollar_empty_list_error
    code: '{}[$]'
    expect:
      error: E_RANGE

  - name: dollar_list_assign_last
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[$] = "foobar";
      return t;
    expect:
      value: [1, 2, 3, 4, 5, 6, "foobar"]

  - name: dollar_list_assign_last_minus_one
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[$ - 1] = "foobar";
      return t;
    expect:
      value: [1, 2, 3, 4, 5, "foobar", 7]

  # Dollar ($) as index - strings
  - name: dollar_string_last
    code: '"foobar"[$]'
    expect:
      value: "r"

  - name: dollar_string_last_minus_one
    code: '"foobar"[$ - 1]'
    expect:
      value: "a"

  - name: dollar_empty_string_error
    code: '""[$]'
    expect:
      error: E_RANGE

  - name: dollar_string_assign_last
    statement: |
      t = "foobar";
      t[$] = "x";
      return t;
    expect:
      value: "foobax"

  - name: dollar_string_assign_last_minus_one
    statement: |
      t = "foobar";
      t[$ - 1] = "x";
      return t;
    expect:
      value: "foobxr"

  # Ranges - maps
  - name: range_map_full
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][^..$]'
    expect:
      value: {1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7}

  - name: range_map_inner
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][^ + 1 .. $ - 1]'
    expect:
      value: {2: 2, 3: 3, 4: 4, 5: 5, 6: 6}

  - name: range_map_inverted
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][$..^]'
    expect:
      value: {}

  - name: range_map_assign_exact
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [2 -> "two", 3 -> "three", 4 -> "four"];
      return t;
    expect:
      value: {1: 1, 2: "two", 3: "three", 4: "four", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_delete
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [2 -> "two", 3 -> "three"];
      return t;
    expect:
      value: {1: 1, 2: "two", 3: "three", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_shift_keys
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [3 -> "three", 4 -> "four"];
      return t;
    expect:
      value: {1: 1, 3: "three", 4: "four", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_prepend_keys
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [1 -> "one", 2 -> "two", 3 -> "three", 4 -> "four"];
      return t;
    expect:
      value: {1: "one", 2: "two", 3: "three", 4: "four", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_append_keys
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [2 -> "two", 3 -> "three", 4 -> "four", 5 -> "five"];
      return t;
    expect:
      value: {1: 1, 2: "two", 3: "three", 4: "four", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_both_prepend_append
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[2..4] = [1 -> "one", 2 -> "two", 3 -> "three", 4 -> "four", 5 -> "five"];
      return t;
    expect:
      value: {1: "one", 2: "two", 3: "three", 4: "four", 5: 5, 6: 6, 7: 7}

  - name: range_map_assign_string_keys
    statement: |
      t = ["abc" -> "abc", "one" -> "one"];
      t["one".."one"] = ["one" -> "foo", "two" -> "bar", "xyz" -> "xyz"];
      return t;
    expect:
      value: {"abc": "abc", "one": "foo", "two": "bar", "xyz": "xyz"}

  - name: range_map_assign_inverted_append
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[7..1] = ["a" -> "a", "b" -> "b", "c" -> "c"];
      return t;
    expect:
      value: {1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, "a": "a", "b": "b", "c": "c"}

  - name: range_map_assign_inverted_dollar_caret
    statement: |
      t = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      t[$..^] = ["a" -> "a", "b" -> "b", "c" -> "c"];
      return t;
    expect:
      value: {1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, "a": "a", "b": "b", "c": "c"}

  # Ranges - lists
  - name: range_list_tail
    code: '{"one", "two", "three"}[$ - 1..$]'
    expect:
      value: ["two", "three"]

  - name: range_list_single
    code: '{"one", "two", "three"}[3..3]'
    expect:
      value: ["three"]

  - name: range_list_inverted_invalid
    code: '{"one", "two", "three"}[17..12]'
    expect:
      value: []

  - name: range_list_full
    code: '{1, 2, 3, 4, 5, 6, 7}[^..$]'
    expect:
      value: [1, 2, 3, 4, 5, 6, 7]

  - name: range_list_inner
    code: '{1, 2, 3, 4, 5, 6, 7}[^ + 1 .. $ - 1]'
    expect:
      value: [2, 3, 4, 5, 6]

  - name: range_list_inverted
    code: '{1, 2, 3, 4, 5, 6, 7}[$..^]'
    expect:
      value: []

  - name: range_list_assign_replace
    statement: |
      l = {1, 2, 3};
      l[2..3] = {6, 7, 8, 9};
      return l;
    expect:
      value: [1, 6, 7, 8, 9]

  - name: range_list_assign_insert
    statement: |
      l = {1, 6, 7, 8, 9};
      l[2..1] = {10, "foo"};
      return l;
    expect:
      value: [1, 10, "foo", 6, 7, 8, 9]

  - name: range_list_assign_nested_string
    statement: |
      l = {1, 10, "foo", 6, 7, 8, 9};
      l[3][2..$] = "u";
      return l;
    expect:
      value: [1, 10, "fu", 6, 7, 8, 9]

  - name: range_list_assign_inverted_append
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[7..1] = {"a", "b", "c"};
      return t;
    expect:
      value: [1, 2, 3, 4, 5, 6, "a", "b", "c", 2, 3, 4, 5, 6, 7]

  - name: range_list_assign_inverted_dollar_caret
    statement: |
      t = {1, 2, 3, 4, 5, 6, 7};
      t[$..^] = {"a", "b", "c"};
      return t;
    expect:
      value: [1, 2, 3, 4, 5, 6, "a", "b", "c", 2, 3, 4, 5, 6, 7]

  # Ranges - strings
  - name: range_string_tail
    code: '"foobar"[2..$]'
    expect:
      value: "oobar"

  - name: range_string_single
    code: '"foobar"[3..3]'
    expect:
      value: "o"

  - name: range_string_inverted_invalid
    code: '"foobar"[17..12]'
    expect:
      value: ""

  - name: range_string_full
    code: '"foobar"[^..$]'
    expect:
      value: "foobar"

  - name: range_string_inner
    code: '"foobar"[^ + 1 .. $ - 1]'
    expect:
      value: "ooba"

  - name: range_string_inverted
    code: '"foobar"[$..^]'
    expect:
      value: ""

  - name: range_string_assign_append
    statement: |
      s = "foobar";
      s[7..12] = "baz";
      return s;
    expect:
      value: "foobarbaz"

  - name: range_string_assign_replace
    statement: |
      s = "foobarbaz";
      s[1..3] = "fu";
      return s;
    expect:
      value: "fubarbaz"

  - name: range_string_assign_prepend
    statement: |
      s = "fubarbaz";
      s[1..0] = "test";
      return s;
    expect:
      value: "testfubarbaz"

  - name: range_string_assign_inverted_append
    statement: |
      s = "1234567";
      s[7..1] = "abc";
      return s;
    expect:
      value: "123456abc234567"

  - name: range_string_assign_inverted_dollar_caret
    statement: |
      s = "1234567";
      s[$..^] = "abc";
      return s;
    expect:
      value: "123456abc234567"

  # Decompile and disassemble
  - name: decompile_with_index_operators
    permission: wizard
    skip: "Barn: verb_code returns original source verbatim, needs AST unparse for normalization"
    statement: |
      o = create($nothing);
      add_verb(o, {player, "xd", "foobar"}, {"this", "none", "this"});
      set_verb_code(o, "foobar", {"return \"foobar\"[^ + 2 ^ 2 .. $ - #0.off];"});
      vc = verb_code(o, "foobar");
      recycle(o);
      return vc;
    expect:
      value: ["return \"foobar\"[^ + 2 ^ 2..$ - $off];"]

  - name: disassemble_with_index_operators
    permission: wizard
    statement: |
      o = create($nothing);
      add_verb(o, {player, "xd", "foobar"}, {"this", "none", "this"});
      set_verb_code(o, "foobar", {"return \"foobar\"[^..$];"});
      vc = disassemble(o, "foobar");
      return vc;
    expect:
      match: "FIRST"

  # Precedence tests
  - name: exponentiation_precedence_in_range
    code: '{1, 2, 3, 4, 5, 6, 7}[^ .. 2 ^ 2]'
    expect:
      value: [1, 2, 3, 4]

  - name: exponentiation_precedence_in_index
    code: '{1, 2, 3, 4, 5, 6, 7}[^ + 2 ^ 2]'
    expect:
      value: 5

  - name: exponentiation_precedence_direct
    code: '{1, 2, 3, 4, 5, 6, 7}[2 ^ 2]'
    expect:
      value: 4

  # Error cases - ints
  - name: int_caret_error
    code: '5[^]'
    expect:
      error: E_TYPE

  - name: int_dollar_error
    code: '5[$]'
    expect:
      error: E_TYPE

  - name: int_range_error
    code: '5[^..$]'
    expect:
      error: E_TYPE

  - name: int_caret_assign_error
    statement: |
      x = 5;
      x[^] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: int_dollar_assign_error
    statement: |
      x = 5;
      x[$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: int_range_assign_error
    statement: |
      x = 5;
      x[^..$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  # Error cases - floats
  - name: float_caret_error
    code: '5.0[^]'
    expect:
      error: E_TYPE

  - name: float_dollar_error
    code: '5.0[$]'
    expect:
      error: E_TYPE

  - name: float_range_error
    code: '5.0[^..$]'
    expect:
      error: E_TYPE

  - name: float_caret_assign_error
    statement: |
      x = 5.0;
      x[^] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: float_dollar_assign_error
    statement: |
      x = 5.0;
      x[$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: float_range_assign_error
    statement: |
      x = 5.0;
      x[^..$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  # Type mismatch errors - maps
  - name: map_list_index_error
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5][[]]'
    expect:
      error: E_TYPE

  - name: map_map_index_error
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5][{}]'
    expect:
      error: E_TYPE

  - name: map_string_assign_error
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[^..$] = "foobar";
      return x;
    expect:
      error: E_TYPE

  - name: map_list_assign_error
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[^..$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  # Type mismatch errors - lists
  - name: list_obj_index_error
    code: '{1, 2, 3, 4, 5}[#1]'
    expect:
      error: E_TYPE

  - name: list_string_index_error
    code: '{1, 2, 3, 4, 5}["foo"]'
    expect:
      error: E_TYPE

  - name: list_obj_assign_error
    statement: |
      x = {1, 2, 3, 4, 5};
      x[#1] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: list_string_assign_error
    statement: |
      x = {1, 2, 3, 4, 5};
      x["foo"] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: list_string_range_assign_error
    statement: |
      x = {1, 2, 3, 4, 5};
      x[^..$] = "foobar";
      return x;
    expect:
      error: E_TYPE

  - name: list_map_range_assign_error
    statement: |
      x = {1, 2, 3, 4, 5};
      x[^..$] = [#1 -> "foobar"];
      return x;
    expect:
      error: E_TYPE

  # Type mismatch errors - strings
  - name: string_obj_index_error
    code: '"12345"[#1]'
    expect:
      error: E_TYPE

  - name: string_string_index_error
    code: '"12345"["foo"]'
    expect:
      error: E_TYPE

  - name: string_obj_assign_error
    statement: |
      x = "12345";
      x[#1] = "a";
      return x;
    expect:
      error: E_TYPE

  - name: string_string_assign_error
    statement: |
      x = "12345";
      x["foo"] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: string_list_range_assign_error
    statement: |
      x = "12345";
      x[^..$] = {1, 2, 3};
      return x;
    expect:
      error: E_TYPE

  - name: string_map_range_assign_error
    statement: |
      x = "12345";
      x[^..$] = [#1 -> "foobar"];
      return x;
    expect:
      error: E_TYPE

  # Collections as indexes - invalid
  - name: map_key_empty_list
    code: '[[] -> []]'
    expect:
      error: E_TYPE

  - name: map_key_empty_map
    code: '[{} -> {}]'
    expect:
      error: E_TYPE

  - name: map_index_empty_list
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      return x[[]];
    expect:
      error: E_TYPE

  - name: map_index_empty_map
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      return x[{}];
    expect:
      error: E_TYPE

  - name: map_assign_empty_list
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[[]] = "1";
      return x;
    expect:
      error: E_TYPE

  - name: map_assign_empty_map
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[{}] = #1;
      return x;
    expect:
      error: E_TYPE

  - name: map_range_end_list
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      return x[1..[]];
    expect:
      error: E_TYPE

  - name: map_range_end_map
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      return x[1..{}];
    expect:
      error: E_TYPE

  - name: map_range_assign_end_list
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[1..[]] = ["1" -> "1"];
      return x;
    expect:
      error: E_TYPE

  - name: map_range_assign_end_map
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5];
      x[1..{}] = [#1 -> #1];
      return x;
    expect:
      error: E_TYPE

  # Inverted ranges are empty
  - name: inverted_range_map
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][6..2]'
    expect:
      value: {}

  - name: inverted_range_list
    code: '{1, 2, 3, 4, 5, 6, 7}[6..2]'
    expect:
      value: []

  - name: inverted_range_string
    code: '"foobar"[5..2]'
    expect:
      value: ""

  # Inverted ranges are empty even with invalid indexes
  - name: inverted_range_map_invalid
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][16..12]'
    expect:
      value: {}

  - name: inverted_range_list_invalid
    code: '{1, 2, 3, 4, 5, 6, 7}[16..12]'
    expect:
      value: []

  - name: inverted_range_string_invalid
    code: '"foobar"[15..12]'
    expect:
      value: ""

  # Range indexes must be valid
  - name: range_map_end_invalid
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][2..16]'
    expect:
      error: E_RANGE

  - name: range_list_end_invalid
    code: '{1, 2, 3, 4, 5, 6, 7}[2..16]'
    expect:
      error: E_RANGE

  - name: range_string_end_invalid
    code: '"foobar"[2..15]'
    expect:
      error: E_RANGE

  - name: range_map_both_invalid
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][12..16]'
    expect:
      error: E_RANGE

  - name: range_list_both_invalid
    code: '{1, 2, 3, 4, 5, 6, 7}[12..16]'
    expect:
      error: E_RANGE

  - name: range_string_both_invalid
    code: '"foobar"[12..15]'
    expect:
      error: E_RANGE

  - name: range_map_start_negative
    code: '[1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7][-2..6]'
    expect:
      error: E_RANGE

  - name: range_list_start_negative
    code: '{1, 2, 3, 4, 5, 6, 7}[-2..6]'
    expect:
      error: E_RANGE

  - name: range_string_start_negative
    code: '"foobar"[-2..5]'
    expect:
      error: E_RANGE

  # Range indexes must be valid on assignment
  - name: range_map_assign_inverted_invalid
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      x[16..12] = ["a" -> "a", "b" -> "b"];
    expect:
      error: E_RANGE

  - name: range_list_assign_inverted_invalid
    statement: |
      x = {1, 2, 3, 4, 5, 6, 7};
      x[16..12] = {"a", "b"};
    expect:
      error: E_RANGE

  - name: range_string_assign_inverted_invalid
    statement: |
      x = "foobar";
      x[15..12] = "ab";
    expect:
      error: E_RANGE

  - name: range_map_assign_negative
    statement: |
      x = [1 -> 1, 2 -> 2, 3 -> 3, 4 -> 4, 5 -> 5, 6 -> 6, 7 -> 7];
      x[6..-2] = ["a" -> "a", "b" -> "b"];
    expect:
      error: E_RANGE

  - name: range_list_assign_negative
    statement: |
      x = {1, 2, 3, 4, 5, 6, 7};
      x[6..-2] = {"a", "b"};
    expect:
      error: E_RANGE

  - name: range_string_assign_negative
    statement: |
      x = "foobar";
      x[5..-2] = "ab";
    expect:
      error: E_RANGE
