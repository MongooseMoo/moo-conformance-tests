name: string
description: Basic string operations

tests:
  - name: length_returns_string_length
    code: 'length("foo")'
    expect:
      value: 3

  - name: strsub_substitutes_substring
    code: 'strsub("foobarbaz", "bar", "quxx")'
    expect:
      value: "fooquxxbaz"

  - name: index_finds_substring_position
    code: 'index("foobar", "bar")'
    expect:
      value: 4

  - name: index_returns_zero_when_not_found
    code: 'index("foobar", "baz")'
    expect:
      value: 0

  - name: index_case_sensitive_finds_match
    code: 'index("fooBar", "bar")'
    expect:
      value: 4

  - name: index_case_sensitive_no_match
    code: 'index("fooBar", "baz")'
    expect:
      value: 0

  - name: index_case_insensitive_no_match
    code: 'index("fooBar", "bar", 1)'
    expect:
      value: 0

  - name: rindex_finds_last_occurrence
    code: 'rindex("bazbarbazfoo", "baz")'
    expect:
      value: 7

  - name: rindex_returns_zero_when_not_found
    code: 'rindex("bazbarbazfoo", "quxx")'
    expect:
      value: 0

  - name: rindex_case_sensitive_finds_match
    code: 'rindex("bazbarBazfoo", "baz")'
    expect:
      value: 7

  - name: rindex_case_insensitive_finds_first
    code: 'rindex("bazbarBazfoo", "baz", 1)'
    expect:
      value: 1

  - name: strcmp_less_than
    code: 'strcmp("abc", "abd") < 0'
    expect:
      value: 1

  - name: strcmp_greater_than
    code: 'strcmp("abd", "abc") > 0'
    expect:
      value: 1

  - name: strcmp_equal
    code: 'strcmp("abc", "abc")'
    expect:
      value: 0

  - name: decode_binary_simple_string
    code: 'decode_binary("foo")'
    expect:
      value: ["foo"]

  - name: decode_binary_with_escapes
    code: 'decode_binary("foo~0D~0A")'
    expect:
      value: ["foo", 13, 10]

  - name: decode_binary_multiple_lines
    code: 'decode_binary("foo~0Abar~0A")'
    expect:
      value: ["foo", 10, "bar", 10]

  - name: decode_binary_to_bytes
    code: 'decode_binary("foo~0D~0A", 1)'
    expect:
      value: [102, 111, 111, 13, 10]

  - name: encode_binary_escapes_tilde
    code: 'encode_binary("~foo")'
    expect:
      value: "~7Efoo"

  - name: encode_binary_with_list
    code: 'encode_binary({"foo", 10}, {"bar", 13})'
    expect:
      value: "foo~0Abar~0D"

  - name: encode_binary_with_varargs
    code: 'encode_binary("foo", 10, "bar", 13)'
    expect:
      value: "foo~0Abar~0D"

  - name: crypt_hashes_string
    code: 'crypt("foobar", "SA")'
    expect:
      value: "SAEmC5UwrAl2A"
    # Note: DES crypt supported in cow_py (passlib) but not toaststunt/Windows

  - name: crypt_bcrypt_hashes_string
    code: 'index(crypt("password", "$2b$05$1234567890123456"), "$2b$05$")'
    expect:
      value: 1
    # Note: Uses default cost factor (05) which doesn't require wizard perms
