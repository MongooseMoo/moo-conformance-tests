name: objects
description: Tests for MOO object system - create, recycle, parent/child relationships, inheritance

requires:
  builtins: [create, recycle, parent, parents, chparent, chparents, children, ancestors, descendants, move, valid, max_object, renumber, add_property, delete_property, property_info, set_property_info, clear_property, add_verb, delete_verb, set_verb_code, verb_cache_stats]

tests:
  # Basic object creation - test parent relationships
  - name: create_single_inheritance
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b, $nothing);
      d = create(b, a);
      return {parent(a) == $nothing, parent(b) == a, parent(c) == b, parent(d) == b};
    expect:
      value: [1, 1, 1, 1]

  - name: children_single_inheritance
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      d = create(b);
      return {children(a) == {b}, children(b) == {c, d}, children(c) == {}, children(d) == {}};
    expect:
      value: [1, 1, 1, 1]

  - name: create_sets_owner_correctly
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create(b, $nothing);
      d = create(b, a);
      return {a.owner == player, b.owner == player, c.owner == c, d.owner == a};
    expect:
      value: [1, 1, 1, 1]

  - name: create_multiple_inheritance
    permission: wizard
    statement: |
      b = create($nothing);
      c = create($nothing);
      i = create({b, c});
      j = create({b, c}, i);
      k = create({}, $nothing);
      l = create({});
      return {parents(i) == {b, c}, parents(j) == {b, c}, parents(k) == {}, parents(l) == {}};
    expect:
      value: [1, 1, 1, 1]

  - name: create_invalid_owner_invarg
    permission: wizard
    code: "create($nothing, -2)"
    expect:
      value_contains: "*anonymous*"

  - name: create_invalid_owner_ambiguous
    permission: wizard
    code: "create($nothing, -3)"
    expect:
      value_contains: "*anonymous*"

  - name: create_invalid_owner_failed_match
    permission: wizard
    code: "create($nothing, -4)"
    expect:
      value_contains: "*anonymous*"

  - name: create_invalid_owner_nothing_as_wizard
    permission: wizard
    statement: |
      e = create($nothing, $nothing);
      return e.owner == e;
    expect:
      value: 1

  - name: create_invalid_owner_as_programmer
    permission: programmer
    statement: |
      obj = create($nothing, $nothing);
      return obj.owner == obj;
    expect:
      value: 1

  - name: create_invalid_owner_invarg_as_programmer
    permission: programmer
    code: "create($object, -2)"
    expect:
      value_contains: "*anonymous*"

  # create() errors
  - name: create_no_args
    permission: wizard
    code: "create()"
    expect:
      error: E_ARGS

  - name: create_type_error_int
    permission: wizard
    code: "create(1)"
    expect:
      error: E_TYPE

  - name: create_type_error_string
    permission: wizard
    code: 'create("1")'
    expect:
      error: E_TYPE

  - name: create_type_error_both_args
    permission: wizard
    code: "create(1, 2)"
    expect:
      error: E_TYPE

  - name: create_invalid_parent_ambiguous
    permission: wizard
    code: "create(-3)"
    expect:
      error: E_TYPE

  - name: create_invalid_parent_failed_match
    permission: wizard
    code: "create(-4)"
    expect:
      error: E_TYPE

  - name: create_list_type_error_int
    permission: wizard
    code: "create({1})"
    expect:
      error: E_TYPE

  - name: create_list_type_error_string
    permission: wizard
    code: 'create({"1"})'
    expect:
      error: E_TYPE

  - name: create_list_invalid_nothing
    permission: wizard
    code: "create({$nothing})"
    expect:
      error: E_INVARG

  - name: create_list_invalid_ambiguous
    permission: wizard
    code: "create({-3})"
    expect:
      error: E_TYPE

  - name: create_list_invalid_failed_match
    permission: wizard
    code: "create({-4})"
    expect:
      error: E_TYPE

  - name: create_duplicate_property_error
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      add_property(a, "foo", 123, {a, ""});
      add_property(b, "foo", "abc", {b, ""});
      return create({a, b});
    expect:
      error: E_INVARG

  - name: create_duplicate_parents_error
    permission: wizard
    statement: |
      a = create($nothing);
      return create({a, a});
    expect:
      error: E_INVARG

  - name: create_permission_denied_as_programmer
    permission: programmer
    description: Programmer CAN create from $anonymous (Toast allows this)
    code: "create($anonymous)"
    expect:
      type: obj

  # parent() and chparent()
  - name: chparent_single_inheritance
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, b);
      chparent(b, c);
      return {parent(a) == b, parent(b) == c, parent(c) == $nothing};
    expect:
      value: [1, 1, 1]

  - name: children_after_chparent
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, b);
      chparent(b, c);
      return {children(a) == {}, children(b) == {a}, children(c) == {b}};
    expect:
      value: [1, 1, 1]

  - name: chparent_reparent
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, b);
      chparent(b, c);
      chparent(a, c);
      return {children(a) == {}, children(b) == {}, children(c) == {b, a}};
    expect:
      value: [1, 1, 1]

  - name: chparents_multiple_inheritance
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, $nothing);
      chparent(b, $nothing);
      chparent(c, $nothing);
      chparents(a, {b, c});
      chparents(b, {c});
      chparents(c, {});
      return {parents(a) == {b, c}, parents(b) == {c}, parents(c) == {}};
    expect:
      value: [1, 1, 1]

  - name: ancestors_basic
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparents(a, {b, c});
      chparents(b, {c});
      chparents(c, {});
      return {ancestors(a) == {b, c}, ancestors(b) == {c}, ancestors(c) == {}};
    expect:
      value: [1, 1, 1]

  - name: descendants_basic
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparents(a, {b, c});
      chparents(b, {c});
      chparents(c, {});
      return {descendants(a) == {}, descendants(b) == {a}, descendants(c) == {a, b}};
    expect:
      value: [1, 1, 1]

  - name: chparent_property_reset
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      add_property(a, "foo", "foo", {player, "c"});
      add_property(b, "foo", "foo", {b, ""});
      chparent(c, a);
      c.foo = "bar";
      chparent(c, b);
      pi = property_info(c, "foo");
      return {pi[1] == b && pi[2] == "", c.foo == "foo"};
    expect:
      value: [1, 1]

  - name: chparent_property_conflict_error
    permission: wizard
    statement: |
      a = create($nothing);
      m = create($nothing);
      n = create($nothing);
      add_property(a, "foo", "foo", {a, "rw"});
      add_property(n, "foo", "foo", {n, "rw"});
      chparent(a, m);
      return chparent(m, n);
    expect:
      error: E_INVARG

  - name: chparents_property_conflict_error
    permission: wizard
    statement: |
      a = create($nothing);
      m = create($nothing);
      n = create($nothing);
      add_property(a, "foo", "foo", {a, "rw"});
      add_property(n, "foo", "foo", {n, "rw"});
      chparent(a, m);
      return chparents(m, {n});
    expect:
      error: E_INVARG

  # parent/chparent errors
  - name: parent_invalid_nothing
    permission: wizard
    code: "parent($nothing)"
    expect:
      error: E_INVARG

  - name: chparent_to_nothing_from_nothing
    permission: wizard
    code: "chparent($nothing, $object)"
    expect:
      error: E_INVARG

  - name: chparent_recursive_error
    permission: wizard
    code: "chparent($object, $object)"
    expect:
      error: E_RECMOVE

  - name: chparent_circular_error
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, b);
      chparent(b, c);
      return chparent(c, a);
    expect:
      error: E_RECMOVE

  - name: chparents_recursive_error
    permission: wizard
    code: "chparents($object, {$object})"
    expect:
      error: E_RECMOVE

  - name: chparents_circular_error
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      chparent(a, b);
      chparent(b, c);
      return chparents(c, {a, b});
    expect:
      error: E_RECMOVE

  - name: chparents_duplicate_property_error
    permission: wizard
    statement: |
      d = create($nothing);
      e = create($nothing);
      f = create($nothing);
      add_property(d, "foo", 123, {d, ""});
      add_property(e, "foo", "abc", {e, ""});
      return chparents(f, {d, e});
    expect:
      error: E_INVARG

  - name: chparents_duplicate_parents_error
    permission: wizard
    statement: |
      d = create($nothing);
      f = create($nothing);
      return chparents(f, {d, d});
    expect:
      error: E_INVARG

  # parent() maps parents() to single parent
  - name: parent_maps_parents_list
    permission: programmer
    statement: |
      x = create($nothing);
      y = create($nothing);
      z = create($nothing);
      a = create({x, y, z});
      return parent(a) == x;
    expect:
      value: 1

  - name: parent_maps_parents_single
    permission: programmer
    statement: |
      x = create($nothing);
      b = create({x});
      return parent(b) == x;
    expect:
      value: 1

  - name: parent_maps_parents_empty
    permission: programmer
    statement: |
      c = create({});
      return parent(c);
    expect:
      value: -1

  # recycle()
  - name: recycle_reparents_children_single
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      m = create(b);
      n = create(b);
      recycle(b);
      return {parent(e) == $nothing, parent(m) == e, parent(n) == e};
    expect:
      value: [1, 1, 1]

  - name: recycle_clears_children_single
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      m = create(b);
      n = create(b);
      recycle(b);
      return {children(e) == {m, n}, children(m) == {}, children(n) == {}};
    expect:
      value: [1, 1, 1]

  - name: recycle_clears_location_single
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      m = create(b);
      n = create(b);
      move(b, e);
      move(m, b);
      move(n, b);
      recycle(b);
      return {e.location, m.location, n.location};
    expect:
      value: [-1, -1, -1]

  - name: recycle_clears_contents_single
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      m = create(b);
      n = create(b);
      move(b, e);
      move(m, b);
      move(n, b);
      recycle(b);
      return {e.contents, m.contents, n.contents};
    expect:
      value: [[], [], []]

  - name: recycle_parent_returns_invarg
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      recycle(b);
      return parent(b);
    expect:
      error: E_INVARG

  - name: recycle_children_returns_invarg
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      recycle(b);
      return children(b);
    expect:
      error: E_INVARG

  - name: recycle_location_returns_invind
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      move(b, e);
      recycle(b);
      return b.location;
    expect:
      error: E_INVIND

  - name: recycle_contents_returns_invind
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      move(b, e);
      recycle(b);
      return b.contents;
    expect:
      error: E_INVIND

  - name: recycle_parent_merges_remaining_multiple
    permission: programmer
    statement: |
      a = create({});
      b = create({});
      c = create({});
      m = create({a, b, c});
      recycle(b);
      return parents(m) == {a, c};
    expect:
      value: 1

  - name: recycle_parent_merges_correctly_complex
    permission: programmer
    statement: |
      a = create($object);
      b = create({a});
      c = create({});
      d = create({});
      e = create($nothing);
      m = create({d, e});
      x = create({a, b, c, m});
      recycle(b);
      recycle(m);
      recycle(e);
      return parents(x) == {a, c, d};
    expect:
      value: 1

  # renumber()
  - name: renumber_basic_simple
    description: Test that renumber preserves parent/child relationships
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      move(b, a);
      move(c, b);
      result = renumber(b);
      return {parent(c) == result, result in children(a)};
    expect:
      value: [1, 1]

  - name: renumber_basic
    description: Test renumber fills recycled slot
    permission: wizard
    skip: "Complex test with state-dependent behavior"
    statement: |
      recycle(create($nothing));
      l = -1;
      for o in [0..max_object()]
        if (!valid(o))
          l = toobj(o);
          break;
        endif
      endfor
      a = create($nothing);
      b = create(a);
      c = create(b);
      move(b, a);
      move(c, b);
      result = renumber(b);
      return {result == l, parent(c) == result, result in children(a)};
    expect:
      value: [0, 1, 1]

  # move()
  - name: move_basic
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      move(b, a);
      move(c, b);
      return {a.location == $nothing, b.location == a, c.location == b};
    expect:
      value: [1, 1, 1]

  - name: move_updates_contents
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      move(b, a);
      move(c, b);
      return {a.contents == {b}, b.contents == {c}, c.contents == {}};
    expect:
      value: [1, 1, 1]

  # pass() and verb inheritance
  - name: pass_single_inheritance
    permission: wizard
    statement: |
      e = create($nothing);
      b = create(e);
      c = create(b);
      add_verb(e, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(e, "foo", {"return {\"e\", @`pass() ! ANY => {}'};"});
      add_verb(b, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(b, "foo", {"return {\"b\", @`pass() ! ANY => {}'};"});
      add_verb(c, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(c, "foo", {"return {\"c\", @`pass() ! ANY => {}'};"});
      return c:foo();
    expect:
      value: ["c", "b", "e"]

  # verb invocation and inheritance
  - name: verb_inheritance_basic
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      add_verb(a, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(a, "foo", {"return \"foo\";"});
      return {a:foo(), b:foo(), c:foo()};
    expect:
      value: ["foo", "foo", "foo"]

  - name: verb_inheritance_after_chparent
    permission: wizard
    description: Test that verb inheritance works correctly after chparent operations
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      add_verb(b, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(b, "foo", {"return \"foo\";"});
      chparent(c, b);
      chparent(a, b);
      return {a:foo(), c:foo()};
    expect:
      value: ["foo", "foo"]

  - name: verb_inheritance_multiple_parents
    permission: wizard
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      add_verb(a, {player, "xd", "foo"}, {"this", "none", "this"});
      set_verb_code(a, "foo", {"return verb;"});
      add_verb(b, {player, "xd", "b"}, {"this", "none", "this"});
      set_verb_code(b, "b", {"return \"b\";"});
      add_verb(c, {player, "xd", "c"}, {"this", "none", "this"});
      set_verb_code(c, "c", {"return \"c\";"});
      chparent(c, $nothing);
      chparent(b, c);
      e = create($nothing);
      add_verb(e, {player, "xd", "bar"}, {"this", "none", "this"});
      set_verb_code(e, "bar", {"return verb;"});
      m = create({e, a});
      return {m:bar(), m:foo()};
    expect:
      value: ["bar", "foo"]

  # properties and inheritance
  - name: property_inheritance_basic
    permission: wizard
    statement: |
      e = create($nothing);
      m = create(e);
      add_property(e, "e", "e", {player, ""});
      pi_e = property_info(e, "e");
      pi_m = property_info(m, "e");
      return {pi_e[1] == player && pi_e[2] == "", pi_m[1] == player && pi_m[2] == "", e.e == "e", m.e == "e"};
    expect:
      value: [1, 1, 1, 1]

  - name: property_set_and_clear
    permission: wizard
    statement: |
      e = create($nothing);
      m = create(e);
      n = create(e);
      add_property(e, "e", "e", {player, ""});
      m.e = "m";
      n.e = "n";
      clear_property(m, "e");
      clear_property(n, "e");
      return {e.e, m.e, n.e};
    expect:
      value: ["e", "e", "e"]

  - name: property_inheritance_after_chparent
    permission: wizard
    statement: |
      e = create($nothing);
      b = create($nothing);
      m = create(e);
      add_property(e, "e", "e", {player, ""});
      add_property(b, "b", "b", {player, "r"});
      chparent(e, b);
      pi_e = property_info(e, "b");
      pi_m = property_info(m, "b");
      return {pi_e[1] == player && pi_e[2] == "r", pi_m[1] == player && pi_m[2] == "r", e.b == "b", m.b == "b"};
    expect:
      value: [1, 1, 1, 1]

  - name: property_inheritance_multiple_parents
    permission: wizard
    statement: |
      e = create($nothing);
      b = create($nothing);
      c = create($nothing);
      add_property(e, "e", "e", {player, ""});
      add_property(b, "b", {"b"}, {player, "r"});
      add_property(c, "c", player, {player, "w"});
      chparents(e, {b, c});
      return {e.e == "e", e.b == {"b"}, e.c == player};
    expect:
      value: [1, 1, 1]

  - name: property_delete_from_parent
    permission: wizard
    statement: |
      e = create($nothing);
      c = create($nothing);
      add_property(c, "c", "c", {player, "c"});
      chparent(e, c);
      delete_property(c, "c");
      return e.c;
    expect:
      error: E_PROPNF

  - name: property_delete_propnf_on_child
    permission: wizard
    statement: |
      e = create($nothing);
      m = create(e);
      add_property(e, "e", "e", {player, ""});
      return delete_property(m, "e");
    expect:
      error: E_PROPNF

  - name: property_add_delete_multiple_inheritance
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      d = create({a, c});
      add_property(a, "x", 1, {player, ""});
      add_property(a, "y", 2, {player, ""});
      add_property(a, "z", 3, {player, ""});
      add_property(b, "m", 4, {player, ""});
      add_property(b, "n", 5, {player, ""});
      add_property(c, "c", 6, {player, ""});
      delete_property(a, "y");
      delete_property(b, "m");
      add_property(a, "s", 7, {player, ""});
      add_property(b, "t", 8, {player, ""});
      return {d.x, d.z, d.n, d.c, d.s, d.t};
    expect:
      value: [1, 3, 5, 6, 7, 8]

  # ancestors() and descendants()
  - name: ancestors_linear
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      d = create(c);
      e = create(d);
      return ancestors(e) == {d, c, b, a};
    expect:
      value: 1

  - name: descendants_linear
    permission: wizard
    statement: |
      a = create($nothing);
      b = create(a);
      c = create(b);
      d = create(c);
      e = create(d);
      return descendants(a) == {b, c, d, e};
    expect:
      value: 1

  - name: ancestors_empty_for_root
    permission: wizard
    statement: |
      o = create($nothing);
      return ancestors(o);
    expect:
      value: []

  - name: descendants_empty_for_leaf
    permission: wizard
    statement: |
      o = create($nothing);
      return descendants(o);
    expect:
      value: []

  - name: ancestors_dag_serialization
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      b = create(o);
      c = create(o);
      m = create({a, b});
      n = create({b, c});
      z = create({m, n});
      anc = ancestors(z);
      return length(anc) == 6 && (m in anc) > 0 && (n in anc) > 0 && (a in anc) > 0 && (b in anc) > 0 && (c in anc) > 0 && (o in anc) > 0;
    expect:
      value: 1

  - name: descendants_dag_serialization
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      b = create(o);
      c = create(o);
      m = create({a, b});
      n = create({b, c});
      z = create({m, n});
      desc = descendants(o);
      return length(desc) == 6 && (m in desc) > 0 && (n in desc) > 0 && (a in desc) > 0 && (b in desc) > 0 && (c in desc) > 0 && (z in desc) > 0;
    expect:
      value: 1

  - name: ancestors_include_self
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      b = create(o);
      c = create(o);
      m = create({a, b});
      n = create({b, c});
      z = create({m, n});
      anc = ancestors(z, 1);
      return length(anc) == 7 && (z in anc) > 0 && (m in anc) > 0 && (n in anc) > 0 && (a in anc) > 0 && (b in anc) > 0 && (c in anc) > 0 && (o in anc) > 0;
    expect:
      value: 1

  - name: descendants_include_self
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      b = create(o);
      c = create(o);
      m = create({a, b});
      n = create({b, c});
      z = create({m, n});
      desc = descendants(o, 1);
      return length(desc) == 7 && (o in desc) > 0 && (m in desc) > 0 && (n in desc) > 0 && (a in desc) > 0 && (b in desc) > 0 && (c in desc) > 0 && (z in desc) > 0;
    expect:
      value: 1

  - name: ancestors_exclude_self_explicit
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      z = create({a});
      return ancestors(z, 0) == {a, o};
    expect:
      value: 1

  - name: descendants_exclude_self_explicit
    permission: wizard
    statement: |
      o = create($nothing);
      a = create(o);
      z = create({a});
      return descendants(o, 0) == {a, z};
    expect:
      value: 1

  # various conflict scenarios - chparent with property conflicts raises E_INVARG
  - name: chparent_property_conflict_variations
    permission: wizard
    description: "a defines foo, b defines foo - chparent(a, b) causes property conflict"
    statement: |
      a = create($nothing);
      b = create($nothing);
      c = create($nothing);
      m = create(a);
      n = create(b);
      z = create($nothing);
      add_property(a, "foo", 0, {player, ""});
      add_property(b, "foo", 0, {player, ""});
      add_property(c, "foo", 0, {player, ""});
      add_property(m, "bar", 0, {player, ""});
      add_property(n, "baz", 0, {player, ""});
      add_property(z, "bar", 0, {player, ""});
      return {chparent(a, b), chparent(a, c), chparent(a, z)};
    expect:
      error: E_INVARG

  - name: chparents_property_conflict_variations
    permission: wizard
    statement: |
      a = create($nothing);
      m = create($nothing);
      n = create($nothing);
      z = create($nothing);
      add_property(a, "foo", 0, {player, ""});
      add_property(z, "bar", 0, {player, ""});
      return {chparents(z, {a}), chparents(z, {m, n})};
    expect:
      value: [0, 0]

  # ways of specifying nothing
  - name: create_empty_list_vs_nothing
    permission: wizard
    statement: |
      a = create({});
      b = create($nothing);
      return {parent(a), parent(b), parents(a), parents(b)};
    expect:
      value: [-1, -1, [], []]

  - name: create_nothing_in_list_error
    permission: wizard
    code: "create({$nothing})"
    expect:
      error: E_INVARG

  - name: create_invalid_object_error
    permission: wizard
    statement: |
      x = create($nothing);
      recycle(x);
      return create(x);
    expect:
      error: E_INVARG

  - name: create_invalid_object_in_list_error
    permission: wizard
    statement: |
      x = create($nothing);
      recycle(x);
      return create({x});
    expect:
      error: E_INVARG

  # verb cache stats
  - name: verb_cache_basic
    permission: wizard
    skip: "Server-state dependent - cache not empty on running server"
    statement: |
      vcs = verb_cache_stats();
      if (vcs[1] == 0 && vcs[2] == 0 && vcs[3] == 0 && vcs[4] == 0)
        return 1;
      endif
      return 0;
    expect:
      value: 1
