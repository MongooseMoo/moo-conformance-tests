name: math
description: Math operations and functions

requires:
  builtins: [random, random_bytes]

tests:
  # random() tests
  - name: random_0_is_invalid
    code: "random(0)"
    expect:
      error: E_INVARG

  - name: random_1_returns_1
    code: "random(1)"
    expect:
      value: 1

  - name: random_in_valid_range
    code: "random()"
    expect:
      range: [1, 2147483647]
    skip_if: "feature.64bit"

  - name: random_in_valid_range_64bit
    code: "random()"
    expect:
      range: [1, 9223372036854775807]
    skip_if: "not feature.64bit"

  - name: random_negative_invalid
    code: "random(-1)"
    expect:
      error: E_INVARG

  # random_bytes() tests
  - name: random_bytes_negative_invalid
    code: "random_bytes(-1)"
    expect:
      error: E_INVARG

  - name: random_bytes_0_is_empty_string
    code: "random_bytes(0)"
    expect:
      value: ""

  - name: random_bytes_1_returns_one_byte
    description: Random bytes length varies due to escape encoding (~XX for non-printable)
    skip: "String length varies 1-3 based on printable vs escaped bytes"
    code: "length(random_bytes(1))"
    expect:
      value: 1

  - name: random_bytes_2_returns_two_bytes
    description: Random bytes length varies due to escape encoding (~XX for non-printable)
    skip: "String length varies 2-6 based on printable vs escaped bytes"
    code: "length(random_bytes(2))"
    expect:
      value: 2

  - name: random_bytes_max_limit
    code: "random_bytes(10001)"
    expect:
      error: E_INVARG

  # Division by zero tests
  - name: division_by_zero_float
    code: "1.1 / 0.0"
    expect:
      error: E_DIV

  - name: division_by_zero_int
    code: "1 / 0"
    expect:
      error: E_DIV

  - name: modulus_by_zero_float
    code: "1.1 % 0.0"
    expect:
      error: E_DIV

  - name: modulus_by_zero_int
    code: "1 % 0"
    expect:
      error: E_DIV

  # Minint edge case tests (32-bit)
  - name: minint_division_edge_case
    code: "-2147483648 / -1"
    expect:
      value: -2147483648
    skip_if: "feature.64bit"

  - name: minint_modulus_edge_case
    code: "-2147483648 % -1"
    expect:
      value: 0
    skip_if: "feature.64bit"

  # Minint edge case tests (64-bit)
  - name: minint_division_edge_case_64bit
    code: "-9223372036854775807 / -1"
    expect:
      value: -9223372036854775807
    skip_if: "not feature.64bit"

  - name: minint_modulus_edge_case_64bit
    code: "-9223372036854775807 % -1"
    expect:
      value: 0
    skip_if: "not feature.64bit"

  # Integer division tests
  - name: division_neg_neg_int
    code: "-15 / -3"
    expect:
      value: 5

  - name: division_neg_pos_int
    code: "-15 / 3"
    expect:
      value: -5

  - name: division_pos_neg_int
    code: "15 / -3"
    expect:
      value: -5

  - name: division_pos_pos_int
    code: "15 / 3"
    expect:
      value: 5

  # Float division tests
  - name: division_neg_neg_float
    code: "-15.0 / -3.0"
    expect:
      value: 5.0

  - name: division_neg_pos_float
    code: "-15.0 / 3.0"
    expect:
      value: -5.0

  - name: division_pos_neg_float
    code: "15.0 / -3.0"
    expect:
      value: -5.0

  - name: division_pos_pos_float
    code: "15.0 / 3.0"
    expect:
      value: 5.0

  # Integer modulus tests
  - name: modulus_neg_neg_int
    code: "-15 % -4"
    expect:
      value: -3

  - name: modulus_neg_pos_int
    code: "-15 % 4"
    expect:
      value: 1

  - name: modulus_pos_neg_int
    code: "15 % -4"
    expect:
      value: -1

  - name: modulus_pos_pos_int
    code: "15 % 4"
    expect:
      value: 3

  # Float modulus tests
  - name: modulus_neg_neg_float
    code: "-15.0 % -4.0"
    expect:
      value: -3.0

  - name: modulus_neg_pos_float
    code: "-15.0 % 4.0"
    expect:
      value: 1.0

  - name: modulus_pos_neg_float
    code: "15.0 % -4.0"
    expect:
      value: -1.0

  - name: modulus_pos_pos_float
    code: "15.0 % 4.0"
    expect:
      value: 3.0
