name: algorithms
description: Cryptographic and encoding algorithm builtins (base64, hashing, HMAC, salting, crypt)

requires:
  builtins: [encode_base64, decode_base64, string_hash, binary_hash, value_hash, string_hmac, binary_hmac, value_hmac, salt, crypt]

tests:
  # Base64 Encoding
  - name: encode_base64_empty
    code: 'encode_base64("")'
    expect:
      value: ""

  - name: encode_base64_one_char
    code: 'encode_base64("a")'
    expect:
      value: "YQ=="

  - name: encode_base64_two_char
    code: 'encode_base64("aa")'
    expect:
      value: "YWE="

  - name: encode_base64_three_char
    code: 'encode_base64("aaa")'
    expect:
      value: "YWFh"

  - name: encode_base64_binary_ff
    code: 'encode_base64("~FF")'
    expect:
      value: "/w=="

  - name: encode_base64_binary_fb
    code: 'encode_base64("~FB")'
    expect:
      value: "+w=="

  # URL-safe Base64
  - name: encode_base64_url_safe_empty
    code: 'encode_base64("", 1)'
    expect:
      value: ""

  - name: encode_base64_url_safe_one_char
    code: 'encode_base64("a", 1)'
    expect:
      value: "YQ"

  - name: encode_base64_url_safe_binary_ff
    code: 'encode_base64("~FF", 1)'
    expect:
      value: "_w"

  - name: encode_base64_url_safe_binary_fb
    code: 'encode_base64("~FB", 1)'
    expect:
      value: "-w"

  - name: encode_base64_binary_string_foobar
    code: 'encode_base64("~66~6f~6f~62~61~72")'
    expect:
      value: "Zm9vYmFy"

  - name: encode_base64_bad_binary_string
    code: 'encode_base64("~00~#!~00")'
    expect:
      error: E_INVARG

  - name: encode_base64_length_one_char
    code: 'length(encode_base64("a"))'
    expect:
      value: 4

  - name: encode_base64_url_safe_length_one_char
    code: 'length(encode_base64("a", 1))'
    expect:
      value: 2

  # Base64 Decoding
  - name: decode_base64_one_char
    code: 'decode_base64("YQ==")'
    expect:
      value: "a"

  - name: decode_base64_two_char
    code: 'decode_base64("YWE=")'
    expect:
      value: "aa"

  - name: decode_base64_three_char
    code: 'decode_base64("YWFh")'
    expect:
      value: "aaa"

  - name: decode_base64_binary_ff
    code: 'decode_base64("/w==")'
    expect:
      value: "~FF"

  - name: decode_base64_url_safe_one_char
    code: 'decode_base64("YQ", 1)'
    expect:
      value: "a"

  - name: decode_base64_url_safe_binary_ff
    code: 'decode_base64("_w", 1)'
    expect:
      value: "~FF"

  - name: decode_base64_bad_chars
    code: 'decode_base64("@@@@")'
    expect:
      error: E_INVARG

  - name: decode_base64_not_binary_string
    code: 'decode_base64("~5A~6D~39~76~59~6D~46~79")'
    expect:
      error: E_INVARG

  - name: decode_base64_padding_required_standard
    code: 'decode_base64("dGVzdA")'
    expect:
      error: E_INVARG

  - name: decode_base64_padding_optional_url_safe
    code: 'decode_base64("dGVzdA", 1)'
    expect:
      value: "test"

  - name: decode_base64_embedded_padding
    code: 'decode_base64("dGV=zdA=")'
    expect:
      error: E_INVARG

  - name: decode_base64_too_much_padding
    code: 'decode_base64("dGVzd===")'
    expect:
      error: E_INVARG

  - name: decode_base64_min_length
    code: 'decode_base64("A===")'
    expect:
      error: E_INVARG

  # Hashing - string_hash
  - name: string_hash_abc_md5
    code: 'string_hash("abc", "md5")'
    expect:
      value: "900150983CD24FB0D6963F7D28E17F72"

  - name: string_hash_abc_sha1
    code: 'string_hash("abc", "sha1")'
    expect:
      value: "A9993E364706816ABA3E25717850C26C9CD0D89D"

  - name: string_hash_abc_sha256
    code: 'string_hash("abc", "sha256")'
    expect:
      value: "BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD"

  - name: string_hash_abc_sha256_default
    code: 'string_hash("abc")'
    expect:
      value: "BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD"

  - name: string_hash_abc_ripemd160
    code: 'string_hash("abc", "ripemd160")'
    expect:
      value: "8EB208F7E05D987A9B044A8E98C6B087F15A0BFC"

  - name: string_hash_abc_sha224
    code: 'string_hash("abc", "sha224")'
    expect:
      value: "23097D223405D8228642A477BDA255B32AADBCE4BDA0B3F7E36C9DA7"

  - name: string_hash_abc_sha384
    code: 'string_hash("abc", "sha384")'
    expect:
      value: "CB00753F45A35E8BB5A03D699AC65007272C32AB0EDED1631A8B605A43FF5BED8086072BA1E7CC2358BAECA134C825A7"

  - name: string_hash_abc_sha512
    code: 'string_hash("abc", "sha512")'
    expect:
      value: "DDAF35A193617ABACC417349AE20413112E6FA4E89A97EA20A9EEEE64B55D39A2192992A274FC1A836BA3C23A3FEEBBD454D4423643CE80E2A9AC94FA54CA49F"

  - name: string_hash_invalid_algorithm
    code: 'string_hash("abc", "bozo")'
    expect:
      error: E_INVARG

  # Hashing - binary_hash
  - name: binary_hash_abc_md5
    code: 'binary_hash("abc", "md5")'
    expect:
      value: "900150983CD24FB0D6963F7D28E17F72"

  - name: binary_hash_nulls_sha256
    code: 'binary_hash("~00~00~00~00~00", "sha256")'
    expect:
      value: "8855508AADE16EC573D21E6A485DFD0A7624085C1A14B5ECDD6485DE0C6839A4"

  - name: binary_hash_bad_binary_string
    code: 'binary_hash("~00~#!~00")'
    expect:
      error: E_INVARG

  # Hashing - value_hash
  - name: value_hash_empty_list_sha256
    code: 'value_hash({}, "sha256")'
    expect:
      value: "44136FA355B3678A1146AD16F7E8649E94FB4FC21FE77E8310C060F61CAAFF8A"

  - name: value_hash_empty_map_sha256
    code: 'value_hash([], "sha256")'
    expect:
      value: "4F53CDA18C2BAA0C0354BB5F9A3ECBE5ED12AB4D8E11BA873C2F11161202B945"

  # MD5 Test Vectors
  - name: md5_empty_string
    code: 'string_hash("", "md5")'
    expect:
      value: "D41D8CD98F00B204E9800998ECF8427E"

  - name: md5_single_a
    code: 'string_hash("a", "md5")'
    expect:
      value: "0CC175B9C0F1B6A831C399E269772661"

  - name: md5_message_digest
    code: 'string_hash("message digest", "md5")'
    expect:
      value: "F96B697D7CB7938D525A2F31AAF161D0"

  - name: md5_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "md5")'
    expect:
      value: "C3FCD3D76192E4007DFB496CCA67E13B"

  - name: md5_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "md5")'
    expect:
      value: "D174AB98D277D9F5A5611C2C9F419D9F"

  - name: md5_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "md5")'
    expect:
      value: "57EDF4A22BE3C955AC49DA2E2107B67A"

  - name: md5_38
    code: 'string_hash("38", "md5")'
    expect:
      value: "A5771BCE93E200C36F7CD9DFD0E5DEAA"

  # SHA1 Test Vectors
  - name: sha1_empty_string
    code: 'string_hash("", "sha1")'
    expect:
      value: "DA39A3EE5E6B4B0D3255BFEF95601890AFD80709"

  - name: sha1_single_a
    code: 'string_hash("a", "sha1")'
    expect:
      value: "86F7E437FAA5A7FCE15D1DDCB9EAEAEA377667B8"

  - name: sha1_message_digest
    code: 'string_hash("message digest", "sha1")'
    expect:
      value: "C12252CEDA8BE8994D5FA0290A47231C1D16AAE3"

  - name: sha1_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "sha1")'
    expect:
      value: "32D10C7B8CF96570CA04CE37F2A19D84240D3A89"

  - name: sha1_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha1")'
    expect:
      value: "761C457BF73B14D27E9E9265C46F4B4DDA11F940"

  - name: sha1_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha1")'
    expect:
      value: "50ABF5706A150990A08B2C5EA40FA0E585554732"

  - name: sha1_38
    code: 'string_hash("38", "sha1")'
    expect:
      value: "5B384CE32D8CDEF02BC3A139D4CAC0A22BB029E8"

  # SHA224 Test Vectors
  - name: sha224_empty_string
    code: 'string_hash("", "sha224")'
    expect:
      value: "D14A028C2A3A2BC9476102BB288234C415A2B01F828EA62AC5B3E42F"

  - name: sha224_single_a
    code: 'string_hash("a", "sha224")'
    expect:
      value: "ABD37534C7D9A2EFB9465DE931CD7055FFDB8879563AE98078D6D6D5"

  - name: sha224_abc
    code: 'string_hash("abc", "sha224")'
    expect:
      value: "23097D223405D8228642A477BDA255B32AADBCE4BDA0B3F7E36C9DA7"

  - name: sha224_message_digest
    code: 'string_hash("message digest", "sha224")'
    expect:
      value: "2CB21C83AE2F004DE7E81C3C7019CBCB65B71AB656B22D6D0C39B8EB"

  - name: sha224_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "sha224")'
    expect:
      value: "45A5F72C39C5CFF2522EB3429799E49E5F44B356EF926BCF390DCCC2"

  - name: sha224_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha224")'
    expect:
      value: "BFF72B4FCB7D75E5632900AC5F90D219E05E97A7BDE72E740DB393D9"

  - name: sha224_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha224")'
    expect:
      value: "B50AECBE4E9BB0B57BC5F3AE760A8E01DB24F203FB3CDCD13148046E"

  - name: sha224_38
    code: 'string_hash("38", "sha224")'
    expect:
      value: "4CFCA6DA32DA647198225460722B7EA1284F98C4B179E8DBAE3F93D5"

  - name: sha224_long_repeating
    code: 'string_hash("abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq", "sha224")'
    expect:
      value: "75388B16512776CC5DBA5DA1FD890150B0C6455CB4F58B1952522525"

  # SHA256 Extended Test Vectors
  - name: sha256_empty_string
    code: 'string_hash("", "sha256")'
    expect:
      value: "E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B855"

  - name: sha256_single_a
    code: 'string_hash("a", "sha256")'
    expect:
      value: "CA978112CA1BBDCAFAC231B39A23DC4DA786EFF8147C4E72B9807785AFEE48BB"

  - name: sha256_message_digest
    code: 'string_hash("message digest", "sha256")'
    expect:
      value: "F7846F55CF23E14EEBEAB5B4E1550CAD5B509E3348FBC4EFA3A1413D393CB650"

  - name: sha256_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "sha256")'
    expect:
      value: "71C480DF93D6AE2F1EFAD1447C66C9525E316218CF51FC8D9ED832F2DAF18B73"

  - name: sha256_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha256")'
    expect:
      value: "DB4BFCBD4DA0CD85A60C3C37D3FBD8805C77F15FC6B1FDFE614EE0A7C8FDB4C0"

  - name: sha256_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha256")'
    expect:
      value: "F371BC4A311F2B009EEF952DD83CA80E2B60026C8E935592D0F9C308453C813E"

  - name: sha256_38
    code: 'string_hash("38", "sha256")'
    expect:
      value: "AEA92132C4CBEB263E6AC2BF6C183B5D81737F179F21EFDC5863739672F0F470"

  - name: sha256_long_repeating
    code: 'string_hash("abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq", "sha256")'
    expect:
      value: "248D6A61D20638B8E5C026930C3E6039A33CE45964FF2167F6ECEDD419DB06C1"

  - name: sha256_very_long_repeating
    code: 'string_hash("abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmnhijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu", "sha256")'
    expect:
      value: "CF5B16A778AF8380036CE59E7B0492370B249B11E8F07A51AFAC45037AFEE9D1"

  # SHA384 Extended Test Vectors
  - name: sha384_empty_string
    code: 'string_hash("", "sha384")'
    expect:
      value: "38B060A751AC96384CD9327EB1B1E36A21FDB71114BE07434C0CC7BF63F6E1DA274EDEBFE76F65FBD51AD2F14898B95B"

  - name: sha384_single_a
    code: 'string_hash("a", "sha384")'
    expect:
      value: "54A59B9F22B0B80880D8427E548B7C23ABD873486E1F035DCE9CD697E85175033CAA88E6D57BC35EFAE0B5AFD3145F31"

  - name: sha384_message_digest
    code: 'string_hash("message digest", "sha384")'
    expect:
      value: "473ED35167EC1F5D8E550368A3DB39BE54639F828868E9454C239FC8B52E3C61DBD0D8B4DE1390C256DCBB5D5FD99CD5"

  - name: sha384_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "sha384")'
    expect:
      value: "FEB67349DF3DB6F5924815D6C3DC133F091809213731FE5C7B5F4999E463479FF2877F5F2936FA63BB43784B12F3EBB4"

  - name: sha384_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha384")'
    expect:
      value: "1761336E3F7CBFE51DEB137F026F89E01A448E3B1FAFA64039C1464EE8732F11A5341A6F41E0C202294736ED64DB1A84"

  - name: sha384_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha384")'
    expect:
      value: "B12932B0627D1C060942F5447764155655BD4DA0C9AFA6DD9B9EF53129AF1B8FB0195996D2DE9CA0DF9D821FFEE67026"

  - name: sha384_38
    code: 'string_hash("38", "sha384")'
    expect:
      value: "C071D202AD950B6A04A5F15C24596A993AF8B212467958D570A3FFD4780060638E3A3D06637691D3012BD31122071B2C"

  - name: sha384_very_long_repeating
    code: 'string_hash("abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmnhijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu", "sha384")'
    expect:
      value: "09330C33F71147E83D192FC782CD1B4753111B173B3B05D22FA08086E3B0F712FCC7C71A557E2DB966C3E9FA91746039"

  # SHA512 Extended Test Vectors
  - name: sha512_empty_string
    code: 'string_hash("", "sha512")'
    expect:
      value: "CF83E1357EEFB8BDF1542850D66D8007D620E4050B5715DC83F4A921D36CE9CE47D0D13C5D85F2B0FF8318D2877EEC2F63B931BD47417A81A538327AF927DA3E"

  - name: sha512_single_a
    code: 'string_hash("a", "sha512")'
    expect:
      value: "1F40FC92DA241694750979EE6CF582F2D5D7D28E18335DE05ABC54D0560E0F5302860C652BF08D560252AA5E74210546F369FBBBCE8C12CFC7957B2652FE9A75"

  - name: sha512_message_digest
    code: 'string_hash("message digest", "sha512")'
    expect:
      value: "107DBF389D9E9F71A3A95F6C055B9251BC5268C2BE16D6C13492EA45B0199F3309E16455AB1E96118E8A905D5597B72038DDB372A89826046DE66687BB420E7C"

  - name: sha512_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "sha512")'
    expect:
      value: "4DBFF86CC2CA1BAE1E16468A05CB9881C97F1753BCE3619034898FAA1AABE429955A1BF8EC483D7421FE3C1646613A59ED5441FB0F321389F77F48A879C7B1F1"

  - name: sha512_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha512")'
    expect:
      value: "1E07BE23C26A86EA37EA810C8EC7809352515A970E9253C26F536CFC7A9996C45C8370583E0A78FA4A90041D71A4CEAB7423F19C71B9D5A3E01249F0BEBD5894"

  - name: sha512_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha512")'
    expect:
      value: "72EC1EF1124A45B047E8B7C75A932195135BB61DE24EC0D1914042246E0AEC3A2354E093D76F3048B456764346900CB130D2A4FD5DD16ABB5E30BCB850DEE843"

  - name: sha512_38
    code: 'string_hash("38", "sha512")'
    expect:
      value: "CAAE34A5E81031268BCDAF6F1D8C04D37B7F2C349AFB705B575966F63E2EBF0FD910C3B05160BA087AB7AF35D40B7C719C53CD8B947C96111F64105FD45CC1B2"

  - name: sha512_very_long_repeating
    code: 'string_hash("abcdefghbcdefghicdefghijdefghijkefghijklfghijklmghijklmnhijklmnoijklmnopjklmnopqklmnopqrlmnopqrsmnopqrstnopqrstu", "sha512")'
    expect:
      value: "8E959B75DAE313DA8CF4F72814FC143F8F7779C6EB9F7FA17299AEADB6889018501D289E4900F7E4331B99DEC4B5433AC7D329EEB6DD26545E96E55B874BE909"

  - name: sha512_triple_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "sha512")'
    expect:
      value: "5338370F5655F4DA14572D4FB471539B201485ECFB3D3204048DC6B83E61FAB505BCBBD73E644A1A5D159A32A0889CF3C9591B69B26D31BE56C68838CE3CD63D"

  - name: sha512_very_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890", "sha512")'
    expect:
      value: "33F8901B053E4CC677D3CB4122D96AD9B96B13BF76194CF962488BB4DE4998A71455CB31582DB527ADF77A485B81CF5B722A5E8638EB6BE487400F3AEC006E7C"

  # RIPEMD160 Extended Test Vectors
  - name: ripemd160_empty_string
    code: 'string_hash("", "ripemd160")'
    expect:
      value: "9C1185A5C5E9FC54612808977EE8F548B2258D31"

  - name: ripemd160_single_a
    code: 'string_hash("a", "ripemd160")'
    expect:
      value: "0BDC9D2D256B3EE9DAAE347BE6F4DC835A467FFE"

  - name: ripemd160_alphabet
    code: 'string_hash("abcdefghijklmnopqrstuvwxyz", "ripemd160")'
    expect:
      value: "F71C27109C692C1B56BBDCEB5B9D2865B3708DBC"

  - name: ripemd160_message_digest
    code: 'string_hash("message digest", "ripemd160")'
    expect:
      value: "5D0689EF49D2FAE572B881B123A85FFA21595F36"

  - name: ripemd160_alphanumeric
    code: 'string_hash("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789", "ripemd160")'
    expect:
      value: "B0E20B6E3116640286ED3A87A5713079B21F5189"

  - name: ripemd160_long_digits
    code: 'string_hash("12345678901234567890123456789012345678901234567890123456789012345678901234567890", "ripemd160")'
    expect:
      value: "9B752E45573D4B39F4DBD3323CAB82BF63326BFB"

  - name: ripemd160_38
    code: 'string_hash("38", "ripemd160")'
    expect:
      value: "6B2D075B1CD34CD1C3E43A995F110C55649DAD0E"

  # HMAC - string_hmac
  - name: string_hmac_jefe_sha256
    code: 'string_hmac("what do ya want for nothing?", "Jefe", "sha256")'
    expect:
      value: "5BDCC146BF60754E6A042426089575C75A003F089D2739839DEC58B964EC3843"

  - name: string_hmac_jefe_sha256_default
    code: 'string_hmac("what do ya want for nothing?", "Jefe")'
    expect:
      value: "5BDCC146BF60754E6A042426089575C75A003F089D2739839DEC58B964EC3843"

  - name: string_hmac_empty_sha256
    code: 'string_hmac("", "")'
    expect:
      value: "B613679A0814D9EC772F95D778C35FC5FF1697C493715653C6C712144292C5AD"

  - name: string_hmac_jefe_sha1
    code: 'string_hmac("what do ya want for nothing?", "Jefe", "sha1")'
    expect:
      value: "EFFCDF6AE5EB2FA2D27416D5F184DF9C259A7C79"

  - name: string_hmac_invalid_algorithm
    code: 'string_hmac("abc", "abc", "bozo")'
    expect:
      error: E_INVARG

  # HMAC - binary_hmac
  - name: binary_hmac_jefe_sha1
    code: 'binary_hmac("what do ya want for nothing?", "Jefe", "sha1")'
    expect:
      value: "EFFCDF6AE5EB2FA2D27416D5F184DF9C259A7C79"

  - name: binary_hmac_hi_there_sha1
    code: 'binary_hmac("Hi There", "~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b~0b", "sha1")'
    expect:
      value: "B617318655057264E28BC0B6FB378C8EF146BE00"

  - name: binary_hmac_empty_sha256
    code: 'binary_hmac("", "", "sha256")'
    expect:
      value: "B613679A0814D9EC772F95D778C35FC5FF1697C493715653C6C712144292C5AD"

  - name: binary_hmac_bad_binary_string
    code: 'binary_hmac("~00~#!~00", "key")'
    expect:
      error: E_INVARG

  - name: binary_hmac_bad_key
    code: 'string_hmac("", "~00~#!~00")'
    expect:
      error: E_INVARG

  # HMAC - value_hmac
  - name: value_hmac_jefe_sha1
    code: 'value_hmac("what do ya want for nothing?", "Jefe", "sha1")'
    expect:
      value: "28809E3D8CEA48FABEBA399A4AF2942AEBD89DE4"

  - name: value_hmac_jefe_sha256
    code: 'value_hmac("what do ya want for nothing?", "Jefe", "sha256")'
    expect:
      value: "6E5C2A18FEBCCACA669AC5F4415342714850E76BA86824A3371270E6DD69956F"

  - name: value_hmac_empty_sha256
    code: 'value_hmac("", "", "sha256")'
    expect:
      value: "140B47411F10521CC48851F43C9ABE73016E1D45627C8523D25CBF7FE64F8B03"

  # Hash case sensitivity
  - name: string_hash_case_insensitive_md5
    code: 'string_hash("abc", "md5") == string_hash("abc", "MD5")'
    expect:
      value: 1

  - name: binary_hash_case_insensitive_sha256
    code: 'binary_hash("abc", "sha256") == binary_hash("abc", "SHA256")'
    expect:
      value: 1

  - name: value_hash_case_insensitive_sha1
    code: 'value_hash("abc", "sha1") == value_hash("abc", "SHA1")'
    expect:
      value: 1

  # Binary string output
  # Note: Binary output uses ~XX escape encoding, so each byte = 3 characters
  # MD5: 16 bytes * 3 = 48, SHA1: 20 bytes * 3 = 60, SHA256: 32 bytes * 3 = 96
  - name: string_hash_binary_output_md5
    code: 'length(string_hash("abc", "md5", 1))'
    expect:
      value: 48

  - name: binary_hash_binary_output_sha256
    code: 'length(binary_hash("abc", "sha256", 1))'
    expect:
      value: 96

  - name: value_hash_binary_output_sha1
    code: 'length(value_hash("abc", "sha1", 1))'
    expect:
      value: 60

  - name: string_hmac_binary_output_sha256
    code: 'length(string_hmac("abc", "key", "sha256", 1))'
    expect:
      value: 96

  - name: binary_hmac_binary_output_sha1
    code: 'length(binary_hmac("abc", "key", "sha1", 1))'
    expect:
      value: 60

  - name: value_hmac_binary_output_sha256
    code: 'length(value_hmac("abc", "key", "sha256", 1))'
    expect:
      value: 96

  # Hash/HMAC lengths
  - name: hash_length_md5
    code: 'length(string_hash("", "md5"))'
    expect:
      value: 32

  - name: hash_length_sha1
    code: 'length(string_hash("", "sha1"))'
    expect:
      value: 40

  - name: hash_length_sha224
    code: 'length(string_hash("", "sha224"))'
    expect:
      value: 56

  - name: hash_length_sha256
    code: 'length(string_hash("", "sha256"))'
    expect:
      value: 64

  - name: hash_length_sha384
    code: 'length(string_hash("", "sha384"))'
    expect:
      value: 96

  - name: hash_length_sha512
    code: 'length(string_hash("", "sha512"))'
    expect:
      value: 128

  - name: hash_length_ripemd160
    code: 'length(string_hash("", "ripemd160"))'
    expect:
      value: 40

  # Salt generation - salt(prefix, random_data)
  - name: salt_standard_two_char
    code: 'salt("", "~00~00")'
    expect:
      value: ".."

  - name: salt_standard_requires_two_chars
    code: 'salt("", "")'
    expect:
      error: E_INVARG

  - name: salt_md5_prefix
    code: 'salt("$1$", "~00~00~00~00~00~00")'
    expect:
      value: "$1$........"

  - name: salt_md5_requires_three_chars
    code: 'salt("$1$", "12")'
    expect:
      error: E_INVARG

  - name: salt_sha256_prefix
    code: 'salt("$5$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      value: "$5$................"

  - name: salt_sha256_requires_three_chars
    code: 'salt("$5$", "~00~00")'
    expect:
      error: E_INVARG

  - name: salt_sha256_rounds
    code: 'salt("$5$rounds=10000$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      value: "$5$rounds=10000$................"

  - name: salt_sha256_rounds_min
    code: 'salt("$5$rounds=999$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      error: E_INVARG

  - name: salt_sha256_rounds_max
    code: 'salt("$5$rounds=1000000000$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      error: E_INVARG

  - name: salt_sha512_prefix
    code: 'salt("$6$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      value: "$6$................"

  - name: salt_sha512_requires_three_chars
    code: 'salt("$6$", "~00~00")'
    expect:
      error: E_INVARG

  - name: salt_sha512_rounds
    code: 'salt("$6$rounds=10000$", "~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      value: "$6$rounds=10000$................"

  - name: salt_bcrypt_prefix
    code: 'salt("$2a$", "~00~00~00~00~00~00~00~00~00~00~00~00~00~00~00~00")'
    expect:
      value: "$2a$05$......................"

  - name: salt_bcrypt_requires_sixteen_chars
    code: 'salt("$2a$", "1234567890")'
    expect:
      error: E_INVARG

  - name: salt_bcrypt_cost_factor
    code: 'salt("$2a$16$", "1234567890123456")'
    expect:
      value: "$2a$16$KRGxLBS0Lxe3KBCwKxOzLe"

  - name: salt_bcrypt_cost_min
    code: 'salt("$2a$03$", "1234567890123456")'
    expect:
      error: E_INVARG

  - name: salt_bcrypt_cost_max
    code: 'salt("$2a$32$", "1234567890123456")'
    expect:
      error: E_INVARG

  - name: salt_binary_string
    code: 'salt("", "~00~00")'
    expect:
      value: ".."

  - name: salt_bad_binary_string
    code: 'salt("", "~00~#!")'
    expect:
      error: E_INVARG

  - name: salt_invalid_prefix
    code: 'salt("$99$", "abc")'
    expect:
      error: E_INVARG

  # Crypt
  - name: crypt_one_arg_defaults_to_unix
    code: 'length(crypt("password"))'
    expect:
      value: 13

  - name: crypt_falls_through_to_unix
    code: 'length(crypt("password", "ab"))'
    expect:
      value: 13

  - name: crypt_sha256_with_salt
    code: 'index(crypt("password", "$5$abc"), "$5$")'
    expect:
      value: 1

  - name: crypt_sha256_rounds_wizard
    permission: wizard
    code: 'index(crypt("password", "$5$rounds=10000$abc"), "$5$rounds=10000$")'
    expect:
      value: 1

  - name: crypt_sha256_rounds_non_wizard
    permission: programmer
    code: 'index(crypt("password", "$5$rounds=10000$abc"), "$5$rounds=10000$")'
    expect:
      value: 1

  - name: crypt_sha512_with_salt
    code: 'index(crypt("password", "$6$abc"), "$6$")'
    expect:
      value: 1

  - name: crypt_sha512_rounds_wizard
    permission: wizard
    code: 'index(crypt("password", "$6$rounds=10000$abc"), "$6$rounds=10000$")'
    expect:
      value: 1

  - name: crypt_sha512_rounds_non_wizard
    permission: programmer
    code: 'index(crypt("password", "$6$rounds=10000$abc"), "$6$rounds=10000$")'
    expect:
      value: 1

  - name: crypt_bcrypt_with_salt
    code: 'index(crypt("password", "$2b$05$1234567890123456"), "$2b$05$")'
    expect:
      value: 1

  - name: crypt_bcrypt_requires_sixteen_chars
    code: 'crypt("password", "$2b$05$123456789012345")'
    expect:
      error: E_INVARG

  - name: crypt_bcrypt_cost_factor
    permission: wizard
    code: 'index(crypt("password", "$2b$10$1234567890123456"), "$2b$10$")'
    expect:
      value: 1

  - name: crypt_bcrypt_cost_min
    code: 'crypt("password", "$2b$03$1234567890123456")'
    expect:
      error: E_INVARG

  - name: crypt_bcrypt_cost_max
    code: 'crypt("password", "$2b$32$1234567890123456")'
    expect:
      error: E_INVARG

  - name: crypt_bcrypt_cost_non_five_requires_wizard
    permission: programmer
    code: 'index(crypt("password", "$2b$10$1234567890123456"), "$2b$10$")'
    expect:
      value: 1

  - name: crypt_invalid_salt
    code: 'crypt("password", "$99$abc")'
    expect:
      error: E_INVARG
